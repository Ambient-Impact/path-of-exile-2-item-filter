{% import 'macros/sound.' + itemFilter.templateExtension as sound with context -%}
{% import 'macros/tier_scheme.' + itemFilter.templateExtension as tierScheme with context -%}
{% import 'macros/utilities.' + itemFilter.templateExtension as utilities -%}

# This should be before salvage materials so that the gem quality and gem socket
# rules here take priority.

# Level 19 and 20 uncut gems get special treatment due to their rarity.
#
# @see https://www.poe2wiki.net/wiki/Uncut_gem#Drop_level_breakpoints
Show
  BaseType        {{ utilities.quotedSequence([
    'Uncut Skill Gem',
    'Uncut Spirit Gem',
  ]) }}
  GemLevel        = 20
  {{ tierScheme.output('gems', 's') }}
  PlayEffect      Green
  MinimapIcon     0 Green Star
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"
Show
  BaseType        {{ utilities.quotedSequence([
    'Uncut Skill Gem',
    'Uncut Spirit Gem',
  ]) }}
  GemLevel        = 19
  {{ tierScheme.output('gems', 'a') }}
  PlayEffect      Green
  MinimapIcon     1 Green Star
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"

# All other uncut gems during endgame.
Show
  BaseType        {{ utilities.quotedSequence([
    'Uncut Skill Gem',
    'Uncut Spirit Gem',
    'Uncut Support Gem',
  ]) }}
  {{ tierScheme.output('gems', 'c') }}
  AreaLevel       >= {{ itemFilter.levels.endgamePhase2 }}
  PlayEffect      Green Temp
  MinimapIcon     2 Green Hexagon

# All uncut gems until early endgame.
Show
  BaseType        {{ utilities.quotedSequence([
    'Uncut Skill Gem',
    'Uncut Spirit Gem',
    'Uncut Support Gem',
  ]) }}
  AreaLevel       < {{ itemFilter.levels.endgamePhase2 }}
  {{ tierScheme.output('gems', 'b') }}
  PlayEffect      Green Temp
  MinimapIcon     2 Green Hexagon
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"

# Cut gems with quality.
Show
  Class           Gems
  Quality         >= 1
  {{ tierScheme.output('gems', 'a') }}
  PlayEffect      Green
  MinimapIcon     1 Green Circle
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"

# Cut gems with at least 3 sockets.
Show
  Class           Gems
  Sockets         >= 3
  {{ tierScheme.output('gems', 'a') }}
  PlayEffect      Green
  MinimapIcon     1 Green Circle
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"

# Fallback for all gems not matching the above.
Show
  Class       Gems
  PlayEffect  Green Temp
  MinimapIcon 2 Green Circle
