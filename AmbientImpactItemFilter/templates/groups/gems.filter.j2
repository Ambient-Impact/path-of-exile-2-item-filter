{% import 'macros/colour.' + itemFilter.templateExtension as colour with context -%}
{% import 'macros/sound.' + itemFilter.templateExtension as sound with context -%}
{% import 'macros/utilities.' + itemFilter.templateExtension as utilities -%}

# This should be before salvage materials so that the gem quality and gem socket
# rules here take priority.

# Level 19 and 20 uncut gems get special treatment due to their rarity.
#
# @see https://www.poe2wiki.net/wiki/Uncut_gem#Drop_level_breakpoints
Show
  BaseType        {{ utilities.quotedSequence([
    'Uncut Skill Gem',
    'Uncut Spirit Gem',
  ]) }}
  GemLevel        >= 19
  SetTextColor    {{ colour.output('gems') }}
  SetBorderColor  {{ colour.output('gems') }}
  PlayEffect      Green
  MinimapIcon     0 Green Hexagon
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"
  SetBackgroundColor {{ colour.output('gemsValuable', type='background') }}

# All other uncut gems during endgame.
Show
  BaseType        {{ utilities.quotedSequence([
    'Uncut Skill Gem',
    'Uncut Spirit Gem',
    'Uncut Support Gem',
  ]) }}
  SetTextColor    {{ colour.output('gems') }}
  SetBorderColor  {{ colour.output('gems', 100) }}
  AreaLevel       >= {{ itemFilter.levels.endgamePhase2 }}
  PlayEffect      Green Temp
  MinimapIcon     2 Green Hexagon

# All uncut gems until early endgame.
Show
  BaseType        {{ utilities.quotedSequence([
    'Uncut Skill Gem',
    'Uncut Spirit Gem',
    'Uncut Support Gem',
  ]) }}
  AreaLevel       < {{ itemFilter.levels.endgamePhase2 }}
  SetTextColor    {{ colour.output('gems') }}
  SetBorderColor  {{ colour.output('gems', 180) }}
  PlayEffect      Green Temp
  MinimapIcon     2 Green Hexagon
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"

# Cut gems with quality.
Show
  Class           Gems
  Quality         >= 1
  SetBorderColor  {{ colour.output('gems') }}
  PlayEffect      Green
  MinimapIcon     1 Green Circle
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"

# Cut gems with at least 3 sockets.
Show
  Class           Gems
  Sockets         >= 3
  SetBorderColor  {{ colour.output('gems') }}
  PlayEffect      Green
  MinimapIcon     1 Green Circle
  CustomAlertSoundOptional "{{ sound.output('leveling') }}"

# Fallback for all gems not matching the above.
Show
  Class       Gems
  PlayEffect  Green Temp
  MinimapIcon 2 Green Circle
